<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–¢–∞—Ä–æ –†–∞—Å–∫–ª–∞–¥ ‚Äî –í—ã–±–æ—Ä –∫–∞—Ä—Ç</title>
  <style>
    :root{
      --bg:#0f1724;
      --card-back:#b88a5a;
      --card-front:#fff;
      --accent:#e9d8a6;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      background: linear-gradient(180deg,#071022 0%, #0f1724 100%);
      color:var(--accent);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
    }

    .app {
      width:100%;
      max-width:720px;
      background: rgba(255,255,255,0.02);
      border-radius:12px;
      padding:18px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      text-align:center;
    }

    h1{margin:0 0 10px;font-size:20px}
    p.lead{margin:0 0 18px;color:rgba(233,216,166,0.9)}

    .cards {
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:14px;
      justify-items:center;
      margin-bottom:18px;
    }

    /* –∫–∞—Ä—Ç–æ—á–∫–∞ */
    .card {
      width:110px;
      height:160px;
      perspective:1000px;
    }

    .card-inner {
      width:100%;
      height:100%;
      position:relative;
      transform-style:preserve-3d;
      transition: transform 500ms cubic-bezier(.2,.9,.3,1);
      cursor:pointer;
      border-radius:10px;
    }

    .card.flipped .card-inner {
      transform: rotateY(180deg) rotateZ(var(--rot,0deg));
    }

    .card-face {
      position:absolute;
      width:100%;
      height:100%;
      backface-visibility:hidden;
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:18px;
      box-shadow:0 8px 18px rgba(2,6,23,0.6), inset 0 -4px 6px rgba(0,0,0,0.15);
    }

    .card-back {
      background: linear-gradient(135deg,var(--card-back) 0%, #7b5a3a 100%);
      color:#fff;
    }

    .card-front {
      background: linear-gradient(180deg,#fff,#f3ecd9);
      transform: rotateY(180deg);
      color:#222;
      padding:8px;
      box-sizing:border-box;
      text-align:center;
    }

    .card-number {
      font-size:14px;
      color:rgba(0,0,0,0.6);
      margin-top:8px;
    }

    .controls {
      display:flex;
      gap:10px;
      justify-content:center;
      align-items:center;
      margin-bottom:12px;
    }

    .btn {
      background:transparent;
      border:1px solid rgba(233,216,166,0.15);
      color:var(--accent);
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      transition:all 0.3s ease;
    }

    .btn:hover {
      background:rgba(233,216,166,0.1);
    }

    .btn.primary {
      background:linear-gradient(90deg,#d4b36a,#f0e5b7);
      color:#0b0b0b;
      border:none;
    }

    .btn.primary:hover {
      background:linear-gradient(90deg,#e5c27c,#f7ecce);
    }

    .btn:disabled {
      opacity:0.5;
      cursor:not-allowed;
    }

    .hint {font-size:13px;color:rgba(233,216,166,0.8);margin-bottom:8px}
    .small {font-size:12px;color:rgba(233,216,166,0.65)}
    .success {color:#86efac;font-weight:600;}

    .card-name {
      font-size:12px;
      font-weight:600;
      margin-top:4px;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>üîÆ –¢–∞—Ä–æ –†–∞—Å–∫–ª–∞–¥</h1>
    <p class="lead">–í—ã–±–µ—Ä–∏—Ç–µ 2 –∫–∞—Ä—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–∫–ª–∞–¥–∞</p>

    <div class="cards" id="cards"></div>

    <div class="controls">
      <button class="btn" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä</button>
      <button class="btn primary" id="sendBtn" disabled>–ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥</button>
    </div>

    <p class="hint">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã: <span id="selectedCount">0</span>/2</p>
    <p id="selectionStatus" class="hint">–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–µ –∫–∞—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</p>
    <p class="small">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏</p>
  </div>

  <script>
    // Telegram WebApp API
    const tg = window.Telegram?.WebApp;
    
    if (tg) {
      tg.expand(); // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
      tg.enableClosingConfirmation(); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
    } else {
      console.warn("Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω. –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.");
    }

    // –î–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç –¢–∞—Ä–æ
    const tarotCards = {
      1: { name: "–ú–∞–≥", emoji: "üÉè" },
      2: { name: "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞", emoji: "üîÆ" },
      3: { name: "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", emoji: "üëë" },
      4: { name: "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä", emoji: "‚ö°" },
      5: { name: "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç", emoji: "üìú" },
      6: { name: "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", emoji: "üíû" }
    };

    const cardsContainer = document.getElementById("cards");
    const selectedCountEl = document.getElementById("selectedCount");
    const selectionStatusEl = document.getElementById("selectionStatus");
    const sendBtn = document.getElementById("sendBtn");
    const resetBtn = document.getElementById("resetBtn");

    let selected = []; // –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã (–Ω–æ–º–µ—Ä–∞)
    let locked = false;

    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
    function createCard(cardNumber) {
      const card = document.createElement("div");
      card.className = "card";
      card.dataset.card = cardNumber;
      
      // –°–ª—É—á–∞–π–Ω—ã–π –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ–≤–æ—Ä–æ—Ç –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
      card.style.setProperty('--rot', (Math.random() * 8 - 4).toFixed(2) + "deg");
      
      const inner = document.createElement("div");
      inner.className = "card-inner";

      // –ó–∞–¥–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç—ã
      const back = document.createElement("div");
      back.className = "card-face card-back";
      back.innerHTML = "<div>–¢–∞—Ä–æ<br>üîÆ</div>";

      // –ü–µ—Ä–µ–¥–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç—ã
      const front = document.createElement("div");
      front.className = "card-face card-front";
      front.innerHTML = `
        <div>
          <div>${tarotCards[cardNumber].emoji}</div>
          <div class="card-number">#${cardNumber}</div>
          <div class="card-name">${tarotCards[cardNumber].name}</div>
        </div>
      `;

      inner.appendChild(back);
      inner.appendChild(front);
      card.appendChild(inner);

      card.addEventListener("click", () => onCardClick(card, cardNumber));
      return card;
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–∞—Ä—Ç
    function renderCards() {
      cardsContainer.innerHTML = "";
      Object.keys(tarotCards).forEach(cardNumber => {
        const card = createCard(parseInt(cardNumber));
        cardsContainer.appendChild(card);
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
    function onCardClick(cardEl, cardNumber) {
      if (locked) return;
      
      const isSelected = selected.includes(cardNumber);
      
      // –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ –∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω–æ 2 –∫–∞—Ä—Ç—ã - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
      if (!isSelected && selected.length >= 2) {
        return;
      }

      if (!isSelected) {
        // –í—ã–±–∏—Ä–∞–µ–º –∫–∞—Ä—Ç—É
        selected.push(cardNumber);
        cardEl.classList.add("flipped");
      } else {
        // –û—Ç–º–µ–Ω—è–µ–º –≤—ã–±–æ—Ä
        selected = selected.filter(num => num !== cardNumber);
        cardEl.classList.remove("flipped");
      }

      updateUI();

      // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ 2 –∫–∞—Ä—Ç—ã - –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
      if (selected.length === 2) {
        setTimeout(() => {
          sendBtn.disabled = false;
          selectionStatusEl.innerHTML = '<span class="success">‚úì –ì–æ—Ç–æ–≤–æ! –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥"</span>';
        }, 350);
      } else {
        sendBtn.disabled = true;
        selectionStatusEl.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–µ –∫–∞—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è";
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateUI() {
      selectedCountEl.textContent = selected.length;
    }

    // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞
    resetBtn.addEventListener("click", () => {
      selected = [];
      const allCards = document.querySelectorAll(".card");
      allCards.forEach(card => card.classList.remove("flipped"));
      sendBtn.disabled = true;
      selectionStatusEl.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–µ –∫–∞—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è";
      updateUI();
    });

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç–∞
    sendBtn.addEventListener("click", async () => {
      if (selected.length !== 2) return;
      
      locked = true;
      sendBtn.disabled = true;
      sendBtn.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";

      // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
      const payload = {
        selected: selected,
        timestamp: new Date().toISOString()
      };

      try {
        if (tg && tg.sendData) {
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram –±–æ—Ç–∞
          tg.sendData(JSON.stringify(payload));
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
          selectionStatusEl.innerHTML = '<span class="success">‚úì –†–∞—Å–∫–ª–∞–¥ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è...</span>';
          
          // –î–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
          setTimeout(() => {
            tg.close();
          }, 1000);
          
        } else {
          // –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–±–µ–∑ Telegram)
          console.log("–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:", payload);
          selectionStatusEl.innerHTML = '<span class="success">‚úì –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)</span>';
          sendBtn.textContent = "–ì–æ—Ç–æ–≤–æ!";
          
          // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É
          setTimeout(() => {
            alert(`–í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –±–æ—Ç –ø–æ–ª—É—á–∏–ª –±—ã –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(payload)}`);
            locked = false;
            sendBtn.textContent = "–ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥";
          }, 1500);
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", error);
        selectionStatusEl.textContent = "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
        locked = false;
        sendBtn.disabled = false;
        sendBtn.textContent = "–ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥";
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    renderCards();
    updateUI();

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è
    if (tg) {
      tg.onEvent('viewportChanged', (e) => {
        console.log('Viewport changed:', e);
      });
    }
  </script>
</body>
</html>
